import { Component, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { ActivatedRoute, RouterLink } from '@angular/router';
import { ApiService, Article } from '../../services/api.service';
import { catchError } from 'rxjs/operators';
import { of } from 'rxjs';

@Component({
  selector: 'app-article',
  standalone: true,
  imports: [CommonModule, RouterLink],
  templateUrl: './article.component.html',
  styleUrl: './article.component.scss'
})
export class ArticleComponent implements OnInit {
  article: Article | null = null;

  constructor(
    private route: ActivatedRoute,
    private apiService: ApiService
  ) {}

  ngOnInit() {
    this.route.params.subscribe(params => {
      const idOrSlug = params['id']; // Can be either ID or slug
      this.loadArticle(idOrSlug);
    });
  }

  loadArticle(idOrSlug: string) {
    // First try to load from API
    this.apiService.getArticle(+idOrSlug || idOrSlug as any).pipe(
      catchError((error) => {
        console.error('Error loading article:', error);
        return of(null);
      })
    ).subscribe(article => {
      if (article) {
        this.article = article;
      } else {
        // Fallback to default article by ID
        const id = +idOrSlug;
        if (!isNaN(id)) {
          this.article = this.getDefaultArticleById(id);
        }
      }
    });
  }

  private getDefaultArticleById(id: number): Article | null {
    const articles = this.getDefaultArticles();
    return articles.find(a => a.id === id) || null;
  }

  private getDefaultArticles(): Article[] {
    return [
    {
      id: 1,
      title: 'Рак легень: ранні ознаки та діагностика',
      excerpt: 'Рак легень - одне з найпоширеніших онкологічних захворювань. Дізнайтеся про перші симптоми та сучасні методи діагностики.',
      category: 'Діагностика',
      image: 'https://images.unsplash.com/photo-1631217868264-e5b90bb7e133?w=1200&h=800&fit=crop',
      date: '15 березня 2025',
      readTime: '7 хв',
      content: {
        intro: 'Рак легень залишається одним з найпоширеніших онкологічних захворювань у світі. Рання діагностика значно підвищує шанси на успішне лікування.',
        sections: [
          {
            heading: 'Перші симптоми',
            text: 'Тривалий кашель, що не проходить понад 3 тижні, кровохаркання, задишка, біль у грудях, втрата ваги без причини - це симптоми, які потребують негайного звернення до лікаря.'
          },
          {
            heading: 'Методи діагностики',
            text: 'Сучасна медицина пропонує комплексний підхід: рентгенографія грудної клітки, комп\'ютерна томографія (КТ), бронхоскопія, біопсія та аналіз пухлинних маркерів.'
          },
          {
            heading: 'Скринінг групи ризику',
            text: 'Особам віком 50+ з тривалим стажем куріння рекомендується щорічна низькодозова КТ легень для раннього виявлення новоутворень.'
          },
          {
            heading: 'Важливість ранньої діагностики',
            text: 'Виявлення раку на ранніх стадіях підвищує 5-річну виживаність до 90%. Регулярні обстеження рятують життя.'
          }
        ]
      }
    },
    {
      id: 2,
      title: 'Сучасні методи лікування раку легень',
      excerpt: 'Від хірургічного втручання до таргетної терапії - огляд найефективніших методів лікування онкології легень.',
      category: 'Лікування',
      image: 'https://images.unsplash.com/photo-1579684385127-1ef15d508118?w=1200&h=800&fit=crop',
      date: '10 березня 2025',
      readTime: '8 хв',
      content: {
        intro: 'Лікування раку легень вимагає індивідуального підходу та комбінації різних методів терапії залежно від стадії та типу пухлини.',
        sections: [
          {
            heading: 'Хірургічне лікування',
            text: 'Лобектомія, сегментектомія або пульмонектомія - види операцій залежно від розміру та локалізації пухлини. Сучасні малоінвазивні техніки скорочують період відновлення.'
          },
          {
            heading: 'Хіміотерапія',
            text: 'Застосовується як самостійний метод або в комбінації з хірургією. Сучасні схеми препаратів значно знижують побічні ефекти та підвищують ефективність.'
          },
          {
            heading: 'Променева терапія',
            text: 'Стереотаксична радіотерапія (SBRT) дозволяє прицільно впливати на пухлину з мінімальним ушкодженням здорових тканин.'
          },
          {
            heading: 'Таргетна терапія',
            text: 'Препарати, що впливають на специфічні мутації пухлинних клітин. Ефективні при певних типах раку легень з доведеними генетичними маркерами.'
          }
        ]
      }
    },
    {
      id: 3,
      title: 'Профілактика раку легень',
      excerpt: 'Важливість відмови від куріння, регулярних обстежень та здорового способу життя для профілактики раку легень.',
      category: 'Профілактика',
      image: 'https://images.unsplash.com/photo-1505576399279-565b52d4ac71?w=1200&h=800&fit=crop',
      date: '5 березня 2025',
      readTime: '6 хв',
      content: {
        intro: 'Профілактика раку легень - це комплекс заходів, спрямованих на зниження ризику розвитку захворювання та його раннє виявлення.',
        sections: [
          {
            heading: 'Відмова від куріння',
            text: 'Куріння - головний фактор ризику раку легень. Відмова від куріння знижує ризик захворювання на 50% через 10 років після припинення.'
          },
          {
            heading: 'Уникнення пасивного куріння',
            text: 'Пасивне куріння підвищує ризик раку легень на 20-30%. Важливо уникати приміщень, де курять, та захищати своїх близьких.'
          },
          {
            heading: 'Захист від канцерогенів',
            text: 'Радон, азбест, важкі метали та промислові токсини - відомі канцерогени. Використовуйте засоби захисту при роботі зі шкідливими речовинами.'
          },
          {
            heading: 'Здоровий спосіб життя',
            text: 'Збалансоване харчування, регулярна фізична активність, контроль ваги та достатній сон зміцнюють імунітет та знижують ризик онкології.'
          }
        ]
      }
    },
    {
      id: 4,
      title: 'Хірургічне лікування: що потрібно знати',
      excerpt: 'Підготовка до операції, види хірургічних втручань та реабілітація після видалення пухлини легень.',
      category: 'Хірургія',
      image: 'https://images.unsplash.com/photo-1551076805-e1869033e561?w=1200&h=800&fit=crop',
      date: '1 березня 2025',
      readTime: '9 хв',
      content: {
        intro: 'Хірургічне видалення пухлини - основний метод лікування раку легень на ранніх стадіях. Сучасні технології роблять операції більш безпечними та ефективними.',
        sections: [
          {
            heading: 'Підготовка до операції',
            text: 'Комплексне обстеження включає аналізи, ЕКГ, спірометрію та консультації суміжних фахівців. Важлива психологічна підготовка та налаштування на одужання.'
          },
          {
            heading: 'Види операцій',
            text: 'Лобектомія - видалення частки легені, сегментектомія - видалення сегменту, пульмонектомія - видалення всієї легені. Вибір залежить від розміру та локалізації пухлини.'
          },
          {
            heading: 'Малоінвазивні технології',
            text: 'VATS (відеоторакоскопія) та роботизована хірургія дозволяють виконувати складні операції через невеликі розрізи, що прискорює відновлення.'
          },
          {
            heading: 'Післяопераційний період',
            text: 'Перші дні після операції проводяться в реанімації, потім на відділенні. Дихальна гімнастика, рання активізація та фізіотерапія - ключ до швидкого відновлення.'
          }
        ]
      }
    },
    {
      id: 5,
      title: 'Імунотерапія в лікуванні раку легень',
      excerpt: 'Сучасні досягнення імунотерапії відкривають нові можливості в боротьбі з раком легень.',
      category: 'Інновації',
      image: 'https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?w=1200&h=800&fit=crop',
      date: '25 лютого 2025',
      readTime: '7 хв',
      content: {
        intro: 'Імунотерапія - революційний метод лікування раку, який активує власний імунітет організму для боротьби з пухлиною.',
        sections: [
          {
            heading: 'Принцип дії',
            text: 'Препарати-інгібітори контрольних точок (PD-1, PD-L1) блокують механізми, які дозволяють раковим клітинам уникати імунної відповіді.'
          },
          {
            heading: 'Показання до застосування',
            text: 'Імунотерапія ефективна при немілкоклітинному раку легень з високим рівнем експресії PD-L1. Застосовується як самостійно, так і в комбінації з хіміотерапією.'
          },
          {
            heading: 'Переваги методу',
            text: 'Менше побічних ефектів порівняно з хіміотерапією, можливість тривалої ремісії, підвищення якості життя пацієнтів.'
          },
          {
            heading: 'Перспективи',
            text: 'Розробка нових препаратів та комбінацій відкриває нові можливості. Персоналізований підхід на основі генетичного профілю пухлини - майбутнє онкології.'
          }
        ]
      }
    },
    {
      id: 6,
      title: 'Життя після лікування раку',
      excerpt: 'Психологічна підтримка, фізична реабілітація та повернення до повноцінного життя після лікування.',
      category: 'Реабілітація',
      image: 'https://images.unsplash.com/photo-1544027993-37dbfe43562a?w=1200&h=800&fit=crop',
      date: '20 лютого 2025',
      readTime: '6 хв',
      content: {
        intro: 'Завершення лікування - не кінець шляху, а початок нового етапу життя. Реабілітація та психологічна підтримка важливі для повернення до повноцінного життя.',
        sections: [
          {
            heading: 'Фізична реабілітація',
            text: 'Дихальна гімнастика, ЛФК, поступове відновлення фізичної активності. Індивідуальна програма реабілітації допомагає швидше повернутися до звичного ритму життя.'
          },
          {
            heading: 'Психологічна підтримка',
            text: 'Страх рецидиву, тривога, депресія - нормальні реакції після лікування раку. Робота з психологом або психотерапевтом допомагає опрацювати ці почуття.'
          },
          {
            heading: 'Регулярні обстеження',
            text: 'Контрольні огляди кожні 3-6 місяців протягом перших років після лікування. КТ, аналізи пухлинних маркерів - важливі для раннього виявлення рецидиву.'
          },
          {
            heading: 'Якість життя',
            text: 'Здоров\'я харчування, помірна фізична активність, відмова від шкідливих звичок, хобі та спілкування з близькими - основа повноцінного життя після раку.'
          }
        ]
      }
    }
  ];
  }
}
